<!DOCTYPE html>

<html :lang="$data.site.language" class="bg-rose-300">
  <head>
    <!--- Styles (does it help to start fetching as early as possible?) --->
    <link href="/styles/main.css" rel="stylesheet" webc:keep />

    <!--- Base --->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!--- SEO --->
    <meta name="description" :content="description || $data.site.description.site" />
    <meta name="author" :content="$data.site.author.name" />
    <!--- Title and Image --->
    <script webc:type="js" webc:is="template">
      const isHome = page.url === '/';
      const is404 = page.url === '/404.html';

      // TODO: move this logic to an eleventyComputed title field in the folder frontmatter?
      const pageTitle = isHome
        ? $data.site.title
        : is404
        ? 'Page not found'
        : title ??
          // If no page title has been set, generate one from the fileSlug
          page.fileSlug
            .replace('/', '') // remove leading and trailing slashes
            .split('-') // split on hyphens
            .map((word, index) =>
              // Capitalize the first word and any words that aren't conjunctions; otherwise, return the word as-is (lowercase)
              (index === 0 || !['a', 'and', 'in', 'of', 'on', 'or'].includes(word)
                ? word[0].toUpperCase() + word.slice(1)
                : word
              ).join(' '),
            );

      // Return title and image tags
      `<title>${pageTitle}></title>
       <meta property="og:title" content="${pageTitle}" />
    <script webc:type="js" webc:is="template">
      const currentUrl = require('path').join(site.url, page.url);
      `<link rel="canonical" href="${currentUrl}" />
       <meta property="og:url" content="${currentUrl}" />`;
    </script>

    <meta property="og:type" :content="$data.site.openGraph.type" />
    <meta property="og:title" :content="title || $data.site.title" />
    <meta property="og:description" :content="description || $data.site.description.site" />
    <meta property="og:locale" :content="$data.site.openGraph.locale" />
    <meta property="og:site_name" :content="$data.site.title" />
    <script webc:type="js" webc:is="template">
      if (!title && !private && !eleventyExcludeFromCollections && page.url !== '/' && page.url !== '/404.html') {
        throw new Error(`No title for ${page.url}`);
      }

      // see: https://cloudinary.com/documentation/transformation_reference
      const imageUrl = [
        `https://res.cloudinary.com/${process.env.CLOUDINARY_CLOUD_NAME}/image/upload`,
        'c_fit,w_1200,h_630,f_auto,q_auto',
        // see: https://cloudinary.com/documentation/transformation_reference#e_colorize
        'e_colorize,co_rgb:171717',
        // see: https://cloudinary.com/cookbook/add_a_border_to_images
        'bo_24px_solid_rgb:fda4af,b_rgb:000000,fl_relative',
        // see: https://cloudinary.com/cookbook/overlaying_social_profile_pictures_on_top_of_images
        'l_twitter_name:ooloth.png,w_120,r_max,g_south_east,x_64,y_64',
        // see: https://cloudinary.com/documentation/layers#text_overlays
        `c_fit,l_text:Helvetica_100_extrabold_line_spacing_4:${
          title || $data.site.title
        },co_rgb:fafafa,g_west,x_80,y_-60,w_1040,h_480`,
        `c_fit,l_text:Helvetica_42_bold:${$data.site.title},co_rgb:fafafa,g_south_west,x_80,y_118,w_900`,
        // see: https://support.cloudinary.com/hc/en-us/articles/202521512-How-to-add-a-special-characters-in-text-overlays-
        `c_fit,l_text:Helvetica_36:%252F${page.fileSlug}%252F,co_rgb:fafafa,g_south_west,x_72,y_64,w_900`,
        'mu/blank.png',
      ].join('/');
      `<meta property="og:image" content="${imageUrl}" />`;
    </script>

    <!--- Twitter --->
    <meta name="twitter:card" :content="$data.site.openGraph.twitter.card" />
    <meta name="twitter:creator" :content="$data.site.openGraph.twitter.creator" />
    <meta name="twitter:site" :content="$data.site.openGraph.twitter.site" />

    <!--- Icons --->
    <!--- see: https://developer.mozilla.org/en-US/docs/Learn/HTML/Introduction_to_HTML/The_head_metadata_in_HTML#adding_custom_icons_to_your_site --->
    <link rel="shortcut icon" href="/favicons/favicon.ico" />
    <link rel="manifest" href="/site.webmanifest" />
    <link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png" />
    <meta name="theme-color" content="#ffffff" />
    <meta name="msapplication-TileColor" content="#ffffff" />
    <meta name="msapplication-config" content="/favicons/browserconfig.xml" />

    <!--- Feeds --->
    <link rel="alternate" href="/feed.xml" type="application/atom+xml" title="${site.title}" />
    <link rel="alternate" href="/feed.json" type="application/json" title="${site.title}" />
  </head>

  <body
    @raw="content"
    class="flex flex-col overflow-x-hidden bg-neutral-50 dark:bg-neutral-900 py-7 px-4 sm:px-6 min-h-screen text-[1.1rem] leading-relaxed text-neutral-800 dark:text-neutral-300"
  ></body>
</html>
